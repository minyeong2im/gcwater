import streamlit as st  # 스트리밋을 가져오고 스트리밋을 st라 명칭한다.
# 김천시 수도요금 업종,구경,요금,구간 딕셔너리
이용요금표 = {
    "상수도": {
        "가정용":[
            {"구간":20, "단가":420},
            {"구간":30, "단가":653},
            {"구간":40, "단가":813},
            {"구간":float("inf"), "단가":1072}
        ],
        "일반용":[
            {"구간":50, "단가":727},
            {"구간":100,"단가":960},
            {"구간":300,"단가":1096},
            {"구간":1000,"단가":1268},
            {"구간":float("inf"),"단가":1465}
        ],
        "대중탕용":[
            {"구간":1000,"단가":838},
            {"구간":1500,"단가":997},
            {"구간":2000,"단가":1183},
            {"구간":float("inf"),"단가":555}
        ],
        "전용공업용":[
            {"구간":200,"단가":321},
            {"구간":float("inf"),"단가":555}
        ],
        "산업용":[
            {"구간":15,"단가":420},
            {"구간":float("inf"),"단가":678}
        ],
        "겸업용":[
            {"구간":15,"단가":420}
        ],
    },
    "하수도":{
        "가정용":[
            {"구간":20,"단가":264},
            {"구간":30,"단가":678},
            {"구간":40,"단가":810},
            {"구간":float("inf"),"단가":955}
        ],
        "일반용":[
            {"구간":50,"단가":352},
            {"구간":100,"단가":1015},
            {"구간":300,"단가":1074},
            {"구간":1000,"단가":1133},
            {"구간":float("inf"),"단가":1205}
        ],
        "대중탕용":[
            {"구간":1000,"단가":692},
            {"구간":1500,"단가":1308},
            {"구간":2000,"단가":1471},
            {"구간":float("inf"),"단가":1559}
        ],
        "전용공업용":[
            {"구간":200,"단가":279},
            {"구간":float("inf"),"단가":529}
        ],
        "산업용":[
            {"구간":200,"단가":279},
            {"구간":float("inf"),"단가":529}
        ],
        "겸업용":[
            {"구간":15,"단가":264}
        ]
    }
}

기본요금표 = {
    13:1330,
    20:3700,
    25:5950,
    40:17880,
    50:27410,
    75:65550,
    100:113330,
    150:247010,
    200:309000,
    250:460280,
    300:572280,
}

물이용부담금_단가 = 170

def 기본요금(구경: int)->int:
    매월격월 = 2 if 주기 == "격월" else 1
    return 기본요금표.get(구경, 0) * 매월격월

def 구간요금계산(요율표_리스트: list, 사용량: int) -> int:
    요금 = 0
    이전 = 0
    남음 = 사용량
    for 단계 in 요율표_리스트:
        구간 = 단계["구간"]
        단가 = 단계["단가"]
        사용 = min(남음, 구간 - 이전)
        if 사용 > 0:
            요금 += 사용 * 단가
            남음 -= 사용
            이전 = 구간
        if 남음 <= 0:
            break
    return 요금

def 주기구간조정(원본_리스트:list, 주기: str) -> list:
    매월격월 = 2 if 주기 == "격월" else 1
    변환된 = []
    for 단계 in 원본_리스트:
        구간 = 단계["구간"]
        단가 = 단계["단가"]
        변환된.append({
            "구간":float("inf") if 구간 == float("inf") else 구간 * 매월격월,
            "단가":단가
        })
def 이용요금계산(요율표_리스트: list, 사용량: int) -> int:
    요금 = 0
    이전 = 0
    남음 = 사용량
    for 단계 in 요율표_리스트:
        한도 = 단계["구간"]
        단가 = 단계["단가"]
        사용 = min(남음, 한도 - 이전)
        if 사용 > 0:
            요금 += 사용 * 단가
            남음 -= 사용
            이전 = 한도
        if 남음 <= 0:
            break
    return 요금

def 조정된_요율표(원본_리스트:list, 주기: str) -> list:
    multiplier = 2 if 주기 == "격월" else 1
    변환된 = []
    for 단계 in 원본_리스트:
        구간 = 단계["구간"]
        단가 = 단계["단가"]
        변환된.append({
            "구간":float("inf") if 구간 == float("inf") else 구간 * multiplier,
            "단가":단가
        })
    return 변환된

def 상수도요금(업종:str, 사용량: int, 구경: int, 주기: str="매월") -> dict:
    raw = 이용요금표["상수도"].get(업종)
    if raw is None:
        raise ValueError(f"상수도 업종 '{업종}' 미등록")
    multiplier = 2 if 주기 == "격월" else 1
    table = 조정된_요율표(raw, 주기)
    이용 = 이용요금계산(table, 사용량)
    기본 = 기본요금(구경) * multiplier
    합계 = 기본 + 이용
    return {"기본요금": 기본, "이용요금": 이용, "총요금": 합계}
    
def 상수도요금(업종:str, 사용량: int, 구경: int, 주기: str="매월") -> dict:
    raw = 이용요금표["상수도"].get(업종)
    if raw is None:
        raise ValueError(f"상수도 업종 '{업종}' 미등록")
    매월격월 = 2 if 주기 == "격월" else 1
    table = 구간요금계산(raw, 주기)
    이용 = 주기구간조정(격월일때, 사용량)
    return {"상수도요금": 이용}
def 하수도요금(업종: str, 사용량: int, 주기: str="매월") -> dict:
    raw = 이용요금표["하수도"].get(업종)
    if raw is None:
        raise ValueError(f"하수도 업종 '{업종}' 미등록")
    매월격월 = 2 if 주기 == "격월" else 1
    격월일때 = 

def 물이용부담금요금(사용량:int) -> dict: #이부분 좀더 생각해보자. 리턴쪽
    금액 = 사용량 * 물이용부담금_단가
    return {"물이용부담금": 금액}

def 총요금계산(업종:str, 사용량: int, 구경: int, 하수도여부: bool=True, 주기: str="매월") ->dict:
    상수 = 상수도요금(업종, 사용량, 구경, 주기)
    하수 = 하수도요금(업종, 사용량, 주기) if 하수도여부 else {"기본요금":0,"이용요금":0,"총요금":0}
    부담 = 물이용부담금요금(사용량)
    총 = 상수["총요금"] + 하수["총요금"] + 부담["총요금"]    